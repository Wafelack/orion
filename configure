#!/usr/bin/env bash
set -euo pipefail

DONE='\033[0;32mdone\033[0m'

echo -n "* Generating Makefile ... "
cat > Makefile << EOF
FILES := \$(shell find src/ -name *.rs)

PREFIX := ${HOME}/.orion/
TARGET := target/release/orion
LIB    := lib/
LINK   := /usr/local/bin/orion

\$(TARGET) : \$(FILES)
	cargo test
	cargo build --release

install : \$(TARGET) \$(LIB)
	@echo -n "* Creating Orion directory ... "
	@mkdir -p \$(PREFIX)
	@echo -e "$DONE"
	@echo -n "* Copying Orion binary ... "
	@cp \$(TARGET) \$(PREFIX)
	@echo -e "$DONE"
	@echo -n "* Copying Orion core and standard libraries ... "
	@cp -r \$(LIB) \$(PREFIX)
	@echo -e "$DONE"
	@echo "Orion has been installed to \$(PREFIX). Please add this location in your PATH variable."

link : install
	@echo -n "* Linking \$(LINK) to \$(PREFIX)/orion ..."
	@ln -s \$(PREFIX)/orion \$(LINK)
	@echo -e "$DONE"
	
uninstall : \$(PREFIX)
	@echo -n "* Removing Orion directory ... "
	@rm -fr \$(PREFIX)
	@echo -e "$DONE"
EOF
echo -e $DONE
